<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mural de Postagens - Fundamentos de Laboratório Clínico</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
/**
 * CHANGELOG
 *
 * Instruções para Revisores:
 * Este bloco de comentários registra as modificações significativas do arquivo.
 * Cada nova modificação deve ser adicionada no topo da lista.
 * Use o formato "Versão [número]: [Descrição da modificação]".
 * Mantenha a lista limitada às 4 últimas alterações para clareza e concisão.
 *
 * Versão 1.8: Implementado sistema de cards compactos expansíveis - 4 colunas no desktop, 2 no mobile, com visualização compacta que expande ao clicar mostrando todos os detalhes.
 * Versão 1.7: Correção completa do sistema de loading - removidos estilos conflitantes, unificado o design em um loading moderno com círculo de progresso, animações suaves e indicadores de etapa funcionais.
 * Versão 1.6: Refinados os estilos do container de controle com melhorias na responsividade, efeitos focus e compatibilidade cross-browser para selects personalizados.
 * Versão 1.5: Adicionados novos estilos para o container de controle e elementos de busca/ordenação, garantindo um design moderno e responsivo sem afetar o restante do layout.
 */
:root {
    --primary-color: #2c3e50;
    --secondary-color: #34495e;
    --text-color: #555;
    --light-text-color: #f0f0f0;
    --background-gradient: linear-gradient(135deg, #e3f2fd, #c3e3f3);
    --glass-background: rgba(255, 255, 255, 0.6);
    --flashcard-background: rgba(255, 255, 255, 0.8);
    --border-color: rgba(255, 255, 255, 0.4);
    --shadow-color: rgba(0, 0, 0, 0.08);
    --glass-shadow: 0 4px 30px var(--shadow-color);
}

body {
    font-family: 'Poppins', sans-serif;
    background: var(--background-gradient);
    color: var(--text-color);
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
}

header {
    background: var(--glass-background);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    color: var(--primary-color);
    text-align: center;
    padding: 20px;
    width: 100%;
    border-bottom: 1px solid var(--border-color);
    box-shadow: var(--glass-shadow);
    position: sticky;
    top: 0;
    z-index: 999;
}

header h1 {
    margin: 0;
    font-size: 28px;
    font-weight: 700;
}

.main-container {
    max-width: 1400px; /* Aumentado para acomodar 4 colunas */
    width: 100%;
    margin: 20px auto;
    padding: 0 20px;
}

/* ESTILOS APRIMORADOS PARA O CONTROLS-CONTAINER */
.controls-container {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 16px;
    padding: 24px;
    margin: 20px auto 32px auto;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    max-width: 1400px;
    width: 100%;
}

@media (max-width: 500px) {
    .controls-container {
        padding: 15px;
    }
}

.header-controls {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

@media (min-width: 1024px) {
    .header-controls {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
    }
}

.nova-postagem-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background-color: var(--primary-color);
    color: var(--light-text-color);
    border: none;
    border-radius: 12px;
    padding: 12px 24px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    white-space: nowrap;
    font-family: 'Poppins', sans-serif;
}

.nova-postagem-btn:hover {
    background-color: var(--secondary-color);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    transform: translateY(-1px);
}

.nova-postagem-btn:focus {
    outline: none;
    box-shadow: 0 0 0 2px var(--primary-color), 0 6px 20px rgba(0, 0, 0, 0.3);
}

.nova-postagem-btn svg {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
}

.search-controls {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

@media (min-width: 768px) {
    .search-controls {
        flex-direction: row;
    }
}

@media (min-width: 1024px) {
    .search-controls {
        flex: 1;
        margin-left: 24px;
    }
}

.search-input-container {
    position: relative;
    flex: 1;
}

.search-input {
    width: 100%;
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(0, 0, 0, 0.5);
    border-radius: 12px;
    padding: 12px 12px 12px 40px;
    color: var(--primary-color);
    font-size: 14px;
    font-family: 'Poppins', sans-serif;
    transition: all 0.3s ease;
    box-sizing: border-box;
}

.search-input::placeholder {
    color: var(--secondary-color);
}

.search-input:focus {
    outline: none;
    box-shadow: 0 0 0 2px var(--primary-color);
    border-color: transparent;
    background: rgba(255, 255, 255, 0.15);
}

.search-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--primary-color);
    width: 16px;
    height: 16px;
    pointer-events: none;
}

.select-controls {
    display: flex;
    gap: 8px;
}

.select-trigger {
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(0, 0, 0, 0.5);
    border-radius: 12px;
    padding: 0 32px 0 16px;
    color: var(--primary-color);
    font-size: 14px;
    font-family: 'Poppins', sans-serif;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 160px;
    box-sizing: border-box;
    
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='rgb(44,62,80)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpath d='m6 9 6 6 6-6'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px;
}

.select-trigger:hover {
    background: rgba(255, 255, 255, 0.15);
}

.select-trigger:focus {
    outline: none;
    box-shadow: 0 0 0 2px var(--primary-color);
    border-color: transparent;
    background: rgba(255, 255, 255, 0.15);
}

.select-trigger.sort-select {
    min-width: 140px;
}

.select-trigger option {
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: bold;
    transition: all 0.2s ease;
    z-index: 10;
}

.post-card.expanded .close-expanded-card {
    display: flex;
}

.close-expanded-card:hover {
    background: rgba(0, 0, 0, 0.8);
    transform: scale(1.1);
}

/* Botões de edição/exclusão */
.edit-delete-buttons {
    margin-top: 8px;
    display: flex;
    gap: 6px;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.post-card.expanded .edit-delete-buttons {
    margin-top: 16px;
    opacity: 1;
}

.edit-btn, .delete-btn {
    padding: 4px 8px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 10px;
    font-weight: 500;
    transition: all 0.2s ease;
    font-family: 'Poppins', sans-serif;
}

.post-card.expanded .edit-btn,
.post-card.expanded .delete-btn {
    padding: 6px 12px;
    font-size: 11px;
}

.edit-btn {
    background: var(--primary-color);
    color: white;
}

.edit-btn:hover {
    background: var(--secondary-color);
    transform: translateY(-1px);
}

.delete-btn {
    background: #e74c3c;
    color: white;
}

.delete-btn:hover {
    background: #c0392b;
    transform: translateY(-1px);
}

/* Indicador de expansão */
.expand-indicator {
    position: absolute;
    bottom: 8px;
    right: 8px;
    width: 20px;
    height: 20px;
    background: rgba(44, 62, 80, 0.8);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    transition: all 0.2s ease;
    opacity: 0.7;
}

.post-card:hover .expand-indicator {
    opacity: 1;
    transform: scale(1.1);
}

.post-card.expanded .expand-indicator {
    display: none;
}

/* Animações para expansão */
@keyframes expandCard {
    from {
        transform: translate(-50%, -50%) scale(0.8);
        opacity: 0;
    }
    to {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
    }
}

.post-card.expanded {
    animation: expandCard 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
}

/* Estilos dos modais existentes */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
}

.modal-content {
    background-color: #fefefe;
    margin: 5% auto;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 400px;
    position: relative;
    animation: slideInTop 0.4s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.modal-content-image {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90vh;
    animation: fadeIn 0.3s ease;
    position: relative;
    top: 50%;
    transform: translateY(-50%);
}

#enlarged-image {
    width: 100%;
    height: auto;
    border-radius: 10px;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideInTop {
    from { transform: translateY(-50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.close-btn {
    color: #aaa;
    font-size: 32px;
    font-weight: bold;
    position: absolute;
    top: 10px;
    right: 20px;
    cursor: pointer;
    transition: color 0.3s ease;
}

.close-btn:hover,
.close-btn:focus {
    color: var(--primary-color);
}

.modal-content h2 {
    text-align: center;
    color: var(--primary-color);
    margin-top: 0;
}

.modal-content form label,
.modal-content form input,
.modal-content form textarea,
.modal-content form button {
    display: block;
    width: 100%;
    margin-bottom: 15px;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
}

.modal-content form label {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 5px;
}

.modal-content form input[type="text"],
.modal-content form input[type="date"],
.modal-content form textarea {
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    background: #f8f8f8;
    transition: border-color 0.3s ease;
}

.modal-content form input:focus,
.modal-content form textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(44, 62, 80, 0.1);
}

.flashcard-button {
    font-family: 'Poppins', sans-serif;
    font-size: 16px;
    font-weight: 600;
    padding: 10px 24px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    text-align: center;
    margin: 20px auto;
    display: block;
}

.flashcard-button:hover {
    background: var(--secondary-color);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

/* Estilos para o container do tema de cores */
.color-theme-container {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    background-color: rgba(255, 255, 255, 0.1);
}

.color-theme-container label {
    display: inline-block;
    font-weight: 600;
    margin-bottom: 0 !important;
    color: #333;
    font-size: 14px;
    width: auto !important;
}

.color-selector {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
    justify-content: flex-start;
}

.color-swatch {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.3s ease;
    position: relative;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    flex-shrink: 0;
}

.color-swatch:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.color-swatch.selected {
    border-color: #2c3e50;
    transform: scale(1.15);
    box-shadow: 0 4px 12px rgba(44, 62, 80, 0.4);
}

.color-swatch.selected::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #2c3e50;
    font-weight: bold;
    font-size: 16px;
    text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
}

.color-swatch[data-color="rgba(255, 255, 255, 0.8)"] {
    border: 2px solid #ccc;
}

.color-swatch[data-color="rgba(255, 255, 255, 0.8)"].selected::after {
    color: #2c3e50;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

/* Estilos para a paginação */
.pagination-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    padding: 20px;
    margin-top: 20px;
}

.pagination-container button {
    font-family: 'Poppins', sans-serif;
    font-size: 14px;
    font-weight: 600;
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    background-color: var(--primary-color);
    color: var(--light-text-color);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.pagination-container button:hover:not(:disabled) {
    background-color: var(--secondary-color);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.pagination-container button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
}

#page-info {
    font-family: 'Poppins', sans-serif;
    font-size: 14px;
    font-weight: 500;
    padding: 10px 15px;
    background: var(--flashcard-background);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    color: var(--primary-color);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
}

/* ===== SISTEMA DE LOADING MODERNO ===== */
#loading-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    z-index: 2000;
    display: none;
    align-items: center;
    justify-content: center;
}

.loading-container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    padding: 48px 40px;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    max-width: 400px;
    width: 90%;
    position: relative;
}

.upload-icon {
    width: 48px;
    height: 48px;
    margin: 0 auto 24px auto;
    color: var(--primary-color);
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { 
        transform: scale(1); 
        opacity: 0.8; 
    }
    50% { 
        transform: scale(1.05); 
        opacity: 1; 
    }
}

.progress-circle {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto 32px auto;
}

.progress-circle svg {
    width: 100%;
    height: 100%;
    transform: rotate(-90deg);
}

.progress-circle .track {
    fill: none;
    stroke: #f1f3f4;
    stroke-width: 8;
}

.progress-circle .progress {
    fill: none;
    stroke: var(--primary-color);
    stroke-width: 8;
    stroke-linecap: round;
    stroke-dasharray: 339;
    stroke-dashoffset: 339;
    transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 24px;
    font-weight: 700;
    color: var(--primary-color);
    font-family: 'Poppins', sans-serif;
}

.status-text {
    font-size: 18px;
    color: var(--text-color);
    font-weight: 600;
    margin-bottom: 12px;
    min-height: 28px;
    font-family: 'Poppins', sans-serif;
}

.substatus-text {
    font-size: 14px;
    color: var(--secondary-color);
    font-weight: 400;
    opacity: 0.8;
    min-height: 20px;
    font-family: 'Poppins', sans-serif;
}

.step-indicators {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-top: 32px;
}

.step {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #e2e8f0;
    transition: all 0.4s ease;
    position: relative;
}

.step.active {
    background: var(--primary-color);
    transform: scale(1.3);
    box-shadow: 0 0 0 4px rgba(44, 62, 80, 0.2);
}

.step.completed {
    background: #48bb78;
    transform: scale(1.1);
}

.success-check {
    display: none;
    width: 64px;
    height: 64px;
    margin: 20px auto;
    border-radius: 50%;
    background: linear-gradient(135deg, #48bb78, #38a169);
    position: relative;
    box-shadow: 0 8px 25px rgba(72, 187, 120, 0.3);
}

.success-check::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 32px;
    font-weight: bold;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.success-check.show {
    display: block;
    animation: successPop 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

@keyframes successPop {
    0% { 
        transform: scale(0) rotate(0deg); 
        opacity: 0; 
    }
    50% { 
        transform: scale(1.2) rotate(180deg); 
        opacity: 1; 
    }
    100% { 
        transform: scale(1) rotate(360deg); 
        opacity: 1; 
    }
}

/* Estado de erro */
.loading-container.error-state .progress-circle .progress {
    stroke: #f56565;
}

.loading-container.error-state .progress-text {
    color: #f56565;
}

.loading-container.error-state .status-text {
    color: #e53e3e;
}

.loading-container.error-state .step.active {
    background: #f56565;
    box-shadow: 0 0 0 4px rgba(245, 101, 101, 0.2);
}

/* Animação de fade para o loading */
#loading-modal.show {
    display: flex !important;
    animation: fadeIn 0.3s ease;
}

#loading-modal.hide {
    animation: fadeOut 0.3s ease forwards;
}

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

footer {
    text-align: center;
    padding: 20px;
    background: var(--glass-background);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    color: var(--primary-color);
    width: 100%;
    border-top: 1px solid var(--border-color);
    box-shadow: 0 -4px 30px var(--shadow-color);
    margin-top: auto;
}

footer p {
    margin: 0;
    font-size: 14px;
    font-weight: 400;
}

/* Responsividade específica para cards */
@media (max-width: 480px) {
    .main-container {
        padding: 0 10px;
    }
    
    #mural-container {
        gap: 10px;
    }
    
    .post-image {
        height: 120px;
    }
    
    .post-title {
        font-size: 13px;
    }
    
    .post-description {
        font-size: 11px;
    }
    
    .post-meta {
        font-size: 9px;
    }
    
    .post-tags span {
        font-size: 9px;
        padding: 2px 4px;
    }
    
    .expand-indicator {
        width: 18px;
        height: 18px;
        font-size: 10px;
        bottom: 6px;
        right: 6px;
    }
    
    .post-card.expanded {
        width: 95%;
        max-width: none;
    }
    
    .close-expanded-card {
        width: 28px;
        height: 28px;
        font-size: 16px;
        top: 8px;
        right: 8px;
    }
    
    /* Loading responsivo */
    .loading-container {
        padding: 32px 24px;
        margin: 20px;
    }
    
    .progress-circle {
        width: 100px;
        height: 100px;
    }
    
    .progress-text {
        font-size: 20px;
    }
    
    .status-text {
        font-size: 16px;
    }
    
    .step-indicators {
        gap: 12px;
    }
    
    .step {
        width: 10px;
        height: 10px;
    }
}

/* Melhorias para tablets */
@media (min-width: 768px) and (max-width: 1199px) {
    .post-image {
        height: 150px;
    }
    
    .post-title {
        font-size: 15px;
    }
    
    .post-description {
        font-size: 13px;
    }
}

/* Melhorias para desktop */
@media (min-width: 1200px) {
    .post-image {
        height: 160px;
    }
    
    .post-card.expanded .post-image {
        height: 250px;
    }
}

/* Animações suaves para transições de hover */
.post-card * {
    transition: inherit;
}

/* Estilo para quando não há posts */
.no-posts {
    grid-column: 1 / -1;
    text-align: center;
    padding: 60px 20px;
    color: var(--secondary-color);
    font-size: 16px;
    font-weight: 500;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.4);
}

/* Acessibilidade - Focus states */
.post-card:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
}

.close-expanded-card:focus {
    outline: 2px solid white;
    outline-offset: 2px;
}
    </style>
</head>
<body>

    <header>
        <h1><a href="#">Mural de Postagens</a></h1>
    </header>

    <div class="main-container">
        <div class="controls-container">
            <div class="header-controls">
                <button id="open-post-modal" class="nova-postagem-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 12h14"></path>
                        <path d="M12 5v14"></path>
                    </svg>
                    <span>Nova Postagem</span>
                </button>

                <div class="search-controls">
                    <div class="search-input-container">
                        <input type="text" id="search-input" class="search-input" placeholder="Buscar por título, autor ou tag..." value="">
                        <svg xmlns="http://www.w3.org/2000/svg" class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.3-4.3"></path>
                        </svg>
                    </div>

                    <div class="select-controls">
                        <select id="sort-by" class="select-trigger sort-select">
                            <option value="created_at">Data da Postagem</option>
                            <option value="photo_date">Data da Foto</option>
                            <option value="title">Título</option>
                            <option value="author">Autor</option>
                        </select>

                        <select id="sort-order" class="select-trigger sort-select">
                            <option value="desc">Decrescente</option>
                            <option value="asc">Crescente</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="mural-container">
            <!-- Os cards serão inseridos aqui dinamicamente -->
        </div>

        <div class="pagination-container">
            <button id="prev-page-btn" disabled>Anterior</button>
            <span id="page-info">Página 1</span>
            <button id="next-page-btn">Próximo</button>
        </div>
    </div>

    <!-- Modal para nova postagem -->
    <div id="new-post-modal" class="modal">
        <div class="modal-content">
            <span id="close-post-modal" class="close-btn">&times;</span>
            <h2 id="modal-title">Nova Postagem</h2>
            <form id="post-form">
                <input type="hidden" id="post-id">
                
                <div class="color-theme-container">
                    <label>Tema:</label>
                    <div class="color-selector">
                        <div class="color-swatch selected" data-color="rgba(255, 255, 255, 0.8)" style="background-color: rgba(255, 255, 255, 0.8);"></div>
                        <div class="color-swatch" data-color="#EE82EE" style="background-color: #EE82EE;"></div>
                        <div class="color-swatch" data-color="rgb(0,191,255)" style="background-color: rgb(0,191,255);"></div>
                        <div class="color-swatch" data-color="rgb(127, 255, 212)" style="background-color: rgb(127, 255, 212);"></div>
                        <div class="color-swatch" data-color="rgb(255, 222, 173)" style="background-color: rgb(255, 222, 173);"></div>
                    </div>
                </div>

                <label for="post-title">Título (max 120 caracteres):</label>
                <input type="text" id="post-title" maxlength="120" required>
                
                <label for="post-image">Imagem:</label>
                <input type="file" id="post-image" accept="image/*" required>
                <p id="image-info" style="display:none;">Deixe em branco para manter a imagem atual.</p>

                <label for="post-description">Descrição (max 300 caracteres):</label>
                <textarea id="post-description" maxlength="300" required></textarea>

                <label for="post-author">Autor(es):</label>
                <input type="text" id="post-author" required>
                
                <label for="post-tags">Tags (separadas por vírgula):</label>
                <input type="text" id="post-tags" placeholder="Ex: coleta, análise, segurança">
                
                <label for="photo-date">Data da Foto:</label>
                <input type="date" id="photo-date" required>

                <button type="submit" class="flashcard-button" id="submit-post-btn">Postar</button>
            </form>
        </div>
    </div>

    <!-- Modal de Loading Moderno -->
    <div id="loading-modal">
        <div class="loading-container">
            <!-- Ícone de upload -->
            <div class="upload-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17,8 12,3 7,8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
            </div>

            <!-- Círculo de progresso -->
            <div class="progress-circle">
                <svg>
                    <circle class="track" cx="60" cy="60" r="54"/>
                    <circle class="progress" cx="60" cy="60" r="54" id="progressCircle"/>
                </svg>
                <div class="progress-text" id="progressText">0%</div>
            </div>

            <!-- Textos de status -->
            <div class="status-text" id="statusText">Preparando envio...</div>
            <div class="substatus-text" id="substatusText">Iniciando processo</div>

            <!-- Indicadores de etapa -->
            <div class="step-indicators">
                <div class="step" id="step1"></div>
                <div class="step" id="step2"></div>
                <div class="step" id="step3"></div>
            </div>

            <!-- Ícone de sucesso -->
            <div class="success-check" id="successCheck"></div>
        </div>
    </div>

    <!-- Modal para imagem ampliada -->
    <div id="enlarged-image-modal" class="modal">
        <div class="modal-content-image">
            <span id="close-enlarged-image-modal" class="close-btn">&times;</span>
            <img id="enlarged-image" src="" alt="Imagem Ampliada">
        </div>
    </div>

    <footer>
        <p>&copy; 2025 lucas.batista.eduk@gmail.com | Todos os direitos reservados</p>
    </footer>

    <script>
/**
 * CHANGELOG
 *
 * Instruções para Revisores:
 * Este bloco de comentários registra as modificações significativas do arquivo.
 * Cada nova modificação deve ser adicionada no topo da lista.
 * Use o formato "Versão [número]: [Descrição da modificação]".
 * Mantenha a lista limitada às 4 últimas alterações para clareza e concisão.
 *
 * Versão 2.0: Implementado sistema completo de cards expansíveis - cards compactos no grid que expandem em modal overlay com todas as informações, suporte a 4 colunas no desktop e 2 no mobile.
 * Versão 1.9: Sistema de loading completamente renovado - implementado design moderno com círculo de progresso animado, indicadores de etapa, animações suaves e feedback visual aprimorado durante todo o processo de envio.
 * Versão 1.8: Correção crítica - Removida a classe MinimalLoader incompleta que causava erro de sintaxe e impedia o funcionamento das postagens e botão Nova Postagem. Mantidas as funções de loading existentes.
 * Versão 1.7: Reorganização da lógica de carregamento para uma solução minimalista. A classe 'hidden' foi removida do HTML e o controle de exibição do modal de carregamento é feito diretamente no JavaScript, garantindo que a barra de progresso seja sempre visível durante o processo de envio.
 */
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM completamente carregado e analisado. Iniciando a lógica do script.');

    const API_URL = 'https://mural-de-postagens.vercel.app';
    const obfuscatedKey1 = 'OGMyMjNmZjljM2MyNjc4MzJjMjZhYWNiMjEwMTQ2MDI=';
    const obfuscatedKey2 = 'ZWNjMjlhYjNhNDZmOGZhODc2MWViZGVlOGExZTg1MGQ=';
    
    function getSecureValue(obfuscated) {
        return atob(obfuscated);
    }

    const IMG_API_CONFIGS = [
        { name: 'ImgBB - eduk', endpoint: 'https://api.imgbb.com/1/upload', key: getSecureValue(obfuscatedKey1) },
        { name: 'ImgBB - enova', endpoint: 'https://api.imgbb.com/1/upload', key: getSecureValue(obfuscatedKey2) }
    ];
    const EDIT_TIME_LIMIT_MINUTES = 5;
    const LIMIT_DESCRIPTION = 300;
    const DISPLAY_LIMIT_DESCRIPTION = 100;
    const LIMIT_TITLE = 120;

    let currentPage = 1;
    const postsPerPage = 20; // Aumentado para acomodar mais cards
    let totalPosts = 0;
    let expandedCard = null; // Controle do card expandido

    const openModalBtn = document.getElementById('open-post-modal');
    const newPostModal = document.getElementById('new-post-modal');
    const closeModalBtn = document.getElementById('close-post-modal');
    const postForm = document.getElementById('post-form');
    const muralContainer = document.getElementById('mural-container');
    const enlargedImageModal = document.getElementById('enlarged-image-modal');
    const enlargedImage = document.getElementById('enlarged-image');
    const closeEnlargedImageBtn = document.getElementById('close-enlarged-image-modal');
    
    const searchInput = document.getElementById('search-input');
    const sortBySelect = document.getElementById('sort-by');
    const sortOrderSelect = document.getElementById('sort-order');

    const prevPageBtn = document.getElementById('prev-page-btn');
    const nextPageBtn = document.getElementById('next-page-btn');
    const pageInfoSpan = document.getElementById('page-info');

    const loadingModal = document.getElementById('loading-modal');
    const progressCircle = document.getElementById('progressCircle');
    const progressText = document.getElementById('progressText');
    const statusText = document.getElementById('statusText');
    const substatusText = document.getElementById('substatusText');
    const uploadIcon = document.querySelector('.upload-icon');
    const successCheck = document.getElementById('successCheck');
    const steps = {
        1: document.getElementById('step1'),
        2: document.getElementById('step2'),
        3: document.getElementById('step3')
    };

    // Criar overlay para cards expandidos
    const postOverlay = document.createElement('div');
    postOverlay.className = 'post-overlay';
    document.body.appendChild(postOverlay);

    // Classe para gerenciar o loading moderno
    class LoadingManager {
        constructor() {
            this.circumference = 2 * Math.PI * 54;
            if (progressCircle) {
                progressCircle.style.strokeDasharray = this.circumference;
                progressCircle.style.strokeDashoffset = this.circumference;
            }
        }

        show() {
            if (postForm) postForm.style.display = 'none';
            if (loadingModal) {
                loadingModal.style.display = 'flex';
                loadingModal.classList.add('show');
            }
            this.reset();
            this.updateProgress(0, 'Preparando envio...', 'Validando dados');
        }

        hide() {
            if (loadingModal) {
                loadingModal.classList.add('hide');
                setTimeout(() => {
                    loadingModal.style.display = 'none';
                    loadingModal.classList.remove('show', 'hide');
                    if (postForm) postForm.style.display = 'block';
                }, 300);
            }
        }

        reset() {
            // Resetar todos os elementos
            Object.values(steps).forEach(step => {
                if (step) {
                    step.classList.remove('active', 'completed');
                }
            });
            
            if (uploadIcon) uploadIcon.style.display = 'block';
            if (successCheck) {
                successCheck.style.display = 'none';
                successCheck.classList.remove('show');
            }
            
            // Resetar círculo de progresso
            if (progressCircle) {
                progressCircle.style.strokeDashoffset = this.circumference;
            }
        }

        updateProgress(percent, message, submessage = '') {
            // Atualizar círculo de progresso
            if (progressCircle) {
                const offset = this.circumference - (percent / 100) * this.circumference;
                progressCircle.style.strokeDashoffset = offset;
            }
            
            // Atualizar textos
            if (progressText) progressText.textContent = Math.round(percent) + '%';
            if (statusText) statusText.textContent = message;
            if (substatusText) substatusText.textContent = submessage;
            
            // Atualizar indicadores de etapa
            this.updateSteps(percent);
        }

        updateSteps(percent) {
            if (percent >= 20 && steps[1]) {
                steps[1].classList.add('active');
            }
            if (percent >= 60 && steps[2]) {
                if (steps[1]) steps[1].classList.replace('active', 'completed');
                steps[2].classList.add('active');
            }
            if (percent >= 90 && steps[3]) {
                if (steps[2]) steps[2].classList.replace('active', 'completed');
                steps[3].classList.add('active');
            }
        }

        showSuccess(message = 'Postagem publicada com sucesso!') {
            if (steps[3]) steps[3].classList.replace('active', 'completed');
            if (uploadIcon) uploadIcon.style.display = 'none';
            if (successCheck) {
                successCheck.style.display = 'block';
                successCheck.classList.add('show');
            }
            if (statusText) statusText.textContent = message;
            if (substatusText) substatusText.textContent = 'Redirecionando...';
            this.updateProgress(100, message, 'Concluído');
        }

        showError(message = 'Erro durante o processo') {
            if (statusText) statusText.textContent = message;
            if (substatusText) substatusText.textContent = 'Tente novamente';
            
            // Adicionar classe de erro
            const container = document.querySelector('.loading-container');
            if (container) container.classList.add('error-state');
            
            setTimeout(() => {
                this.hide();
                if (container) container.classList.remove('error-state');
            }, 3000);
        }
    }

    const loadingManager = new LoadingManager();

    // ===== SISTEMA DE EXPANSÃO DE CARDS =====
    function createExpandedCardStructure(post, postElement) {
        const closeBtn = document.createElement('button');
        closeBtn.className = 'close-expanded-card';
        closeBtn.innerHTML = '×';
        closeBtn.setAttribute('aria-label', 'Fechar');
        
        const expandIndicator = document.createElement('div');
        expandIndicator.className = 'expand-indicator';
        expandIndicator.innerHTML = '+';
        
        postElement.appendChild(closeBtn);
        postElement.appendChild(expandIndicator);
        
        return { closeBtn, expandIndicator };
    }

    function expandCard(cardElement, post) {
        if (expandedCard) {
            collapseCard(expandedCard.element);
        }

        // Adicionar classe expanded
        cardElement.classList.add('expanded');
        postOverlay.classList.add('active');
        
        // Desabilitar scroll do body
        document.body.style.overflow = 'hidden';
        
        // Armazenar referência
        expandedCard = {
            element: cardElement,
            post: post
        };

        // Atualizar conteúdo expandido
        updateExpandedContent(cardElement, post);

        // Focus no card expandido para acessibilidade
        cardElement.setAttribute('tabindex', '-1');
        cardElement.focus();
    }

    function collapseCard(cardElement) {
        if (!cardElement) return;
        
        cardElement.classList.remove('expanded');
        postOverlay.classList.remove('active');
        
        // Reabilitar scroll do body
        document.body.style.overflow = '';
        
        // Limpar referência
        expandedCard = null;
        
        cardElement.removeAttribute('tabindex');
    }

    function updateExpandedContent(cardElement, post) {
        // Atualizar descrição completa
        const description = cardElement.querySelector('.post-description');
        if (description && post.description) {
            description.style.webkitLineClamp = 'unset';
            description.textContent = post.description;
        }

        // Tornar tags clicáveis no modo expandido
        const tags = cardElement.querySelectorAll('.post-tags span');
        tags.forEach(tag => {
            tag.style.cursor = 'pointer';
            tag.onclick = (e) => {
                e.stopPropagation();
                const tagText = tag.textContent.substring(1); // Remove #
                searchInput.value = `tag:${tagText}`;
                collapseCard(cardElement);
                currentPage = 1;
                fetchPosts();
            };
        });

        // Tornar botões visíveis
        const editDeleteButtons = cardElement.querySelector('.edit-delete-buttons');
        if (editDeleteButtons) {
            editDeleteButtons.style.opacity = '1';
        }
    }

    // Event listeners para expansão
    postOverlay.addEventListener('click', () => {
        if (expandedCard) {
            collapseCard(expandedCard.element);
        }
    });

    // ESC para fechar card expandido
    document.addEventListener('touchend', (e) => {
        touchEndY = e.changedTouches[0].screenY;
        
        // Swipe down para fechar card expandido
        if (expandedCard && touchEndY > touchStartY + 50) {
            collapseCard(expandedCard.element);
        }
    });

    // Otimização de performance - lazy loading para imagens
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                if (img.dataset.src) {
                    img.src = img.dataset.src;
                    img.removeAttribute('data-src');
                    observer.unobserve(img);
                }
            }
        });
    });

    // Aplicar lazy loading quando necessário
    function applyLazyLoading() {
        const images = document.querySelectorAll('.post-image[data-src]');
        images.forEach(img => imageObserver.observe(img));
    }

    // Debounce para busca
    let searchTimeout;
    if (searchInput) {
        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                currentPage = 1;
                fetchPosts();
            }, 500);
        });
    }

    // Inicializar aplicação
    console.log('🚀 Iniciando aplicação com sistema de cards expansíveis...');
    fetchPosts();
    
    // Log de inicialização
    setTimeout(() => {
        console.log(`✅ Aplicação iniciada com sucesso!`);
        console.log(`📱 Grid responsivo: ${window.innerWidth >= 1200 ? '4' : window.innerWidth >= 768 ? '3' : '2'} colunas`);
    }, 1000);
});
    </script>

</body>
</html>('keydown', (e) => {
        if (e.key === 'Escape' && expandedCard) {
            collapseCard(expandedCard.element);
        }
    });

    function initializeColorSelector() {
        console.log('🎨 Inicializando seletor de cores...');
        const colorSwatches = document.querySelectorAll('.color-selector .color-swatch');
        if (colorSwatches.length === 0) {
            console.error('❌ Nenhuma cor encontrada!');
            return false;
        }
        colorSwatches.forEach((swatch, index) => {
            swatch.replaceWith(swatch.cloneNode(true));
        });
        const newColorSwatches = document.querySelectorAll('.color-selector .color-swatch');
        newColorSwatches.forEach((swatch, index) => {
            swatch.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                newColorSwatches.forEach(s => s.classList.remove('selected'));
                swatch.classList.add('selected');
            });
            swatch.addEventListener('mouseenter', () => {
                if (!swatch.classList.contains('selected')) {
                    swatch.style.transform = 'scale(1.1)';
                }
            });
            swatch.addEventListener('mouseleave', () => {
                if (!swatch.classList.contains('selected')) {
                    swatch.style.transform = 'scale(1)';
                }
            });
        });
        console.log('✅ Seletor de cores inicializado com sucesso!');
        return true;
    }

    function ensureColorSelection() {
        const selectedColor = document.querySelector('.color-swatch.selected');
        if (!selectedColor) {
            const firstColor = document.querySelector('.color-swatch');
            if (firstColor) {
                firstColor.classList.add('selected');
            }
        }
    }

    // Event listeners principais
    if (openModalBtn) {
        openModalBtn.addEventListener('click', () => {
            newPostModal.style.display = 'block';
            resetPostModal();
            setTimeout(() => {
                const success = initializeColorSelector();
                if (success) {
                    ensureColorSelection();
                } else {
                    console.error('❌ Falha ao inicializar seletor de cores');
                }
            }, 150);
        });
    }

    if (closeModalBtn) {
        closeModalBtn.addEventListener('click', () => {
            newPostModal.style.display = 'none';
            postForm.reset();
        });
    }

    if (closeEnlargedImageBtn) {
        closeEnlargedImageBtn.addEventListener('click', () => {
            enlargedImageModal.style.display = 'none';
        });
    }

    window.addEventListener('click', (event) => {
        if (event.target === newPostModal) {
            newPostModal.style.display = 'none';
            postForm.reset();
        }
        if (event.target === enlargedImageModal) {
            enlargedImageModal.style.display = 'none';
        }
    });

    function resetPostModal() {
        document.getElementById('modal-title').textContent = 'Nova Postagem';
        document.getElementById('submit-post-btn').textContent = 'Postar';
        document.getElementById('post-id').value = '';
        document.getElementById('post-image').required = true;
        document.getElementById('image-info').style.display = 'none';
        postForm.style.display = 'block';
        postForm.reset();
        
        setTimeout(() => {
            const colorSwatches = document.querySelectorAll('.color-selector .color-swatch');
            colorSwatches.forEach(swatch => swatch.classList.remove('selected'));
            const firstColor = document.querySelector('.color-selector .color-swatch');
            if (firstColor) {
                firstColor.classList.add('selected');
            }
        }, 50);
    }

    async function uploadImage(imageFile) {
        if (!imageFile) {
            console.warn('Nenhum arquivo de imagem selecionado.');
            return null;
        }
        
        for (let i = 0; i < IMG_API_CONFIGS.length; i++) {
            const config = IMG_API_CONFIGS[i];
            try {
                loadingManager.updateProgress(20 + (i * 10), `Enviando imagem via ${config.name}...`, 'Fazendo upload');
                
                const formData = new FormData();
                formData.append('key', config.key);
                formData.append('image', imageFile);

                const response = await fetch(config.endpoint, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        loadingManager.updateProgress(60, 'Imagem enviada com sucesso!', 'Preparando postagem');
                        return data.data.url;
                    }
                }
            } catch (error) {
                console.warn(`Erro de comunicação com a API ${config.name}.`, error);
                if (i === IMG_API_CONFIGS.length - 1) {
                    loadingManager.showError('Falha no upload da imagem');
                    return null;
                }
            }
        }
        
        loadingManager.showError('Todas as APIs de imagem falharam');
        return null;
    }
    
    const formatarDataExibicao = (data) => {
        if (!data) return 'N/A';
        const partes = data.split('T')[0].split('-');
        return `${partes[2]}-${partes[1]}-${partes[0]}`;
    };

    function createPostElement(post) {
        const postCard = document.createElement('div');
        postCard.classList.add('post-card', 'compact');
        postCard.style.backgroundColor = post.color || 'rgba(255, 255, 255, 0.8)';
        
        // Descrição truncada para modo compacto
        let descriptionText = post.description || '';
        const isLongDescription = descriptionText.length > DISPLAY_LIMIT_DESCRIPTION;
        let truncatedDescription = isLongDescription ? 
            descriptionText.substring(0, DISPLAY_LIMIT_DESCRIPTION) + '...' : 
            descriptionText;

        // Tags HTML
        let tagsHtml = '';
        if (post.tags) {
            const tagsArray = post.tags.split(',').map(tag => tag.trim()).filter(tag => tag);
            tagsHtml = '<div class="post-tags">' + tagsArray.map(tag => `<span>#${tag}</span>`).join('') + '</div>';
        }

        // Verificar se é editável
        const createdPostId = localStorage.getItem('createdPostId');
        const createdAt = localStorage.getItem('createdPostTime');
        const isEditable = createdPostId === post.id && (new Date() - new Date(createdAt)) < (EDIT_TIME_LIMIT_MINUTES * 60 * 1000);
        
        const editDeleteButtons = isEditable ? `
            <div class="edit-delete-buttons">
                <button class="edit-btn" data-id="${post.id}">Editar</button>
                <button class="delete-btn" data-id="${post.id}">Excluir</button>
            </div>
        ` : '';

        const formattedPostDate = formatarDataExibicao(post.created_at);
        const formattedPhotoDate = formatarDataExibicao(post.photo_date);

        postCard.innerHTML = `
            <div class="post-card-content">
                <h3 class="post-title">${post.title}</h3>
                <div class="post-image-container">
                    <img src="${post.image_url}" alt="${post.title}" class="post-image">
                </div>
                <p class="post-description">${truncatedDescription}</p>
                ${tagsHtml}
                <div class="post-meta">
                    <span class="post-author">Autor: ${post.author}</span>
                    <span class="post-date">Foto: ${formattedPhotoDate}</span>
                    <span class="post-date">Postagem: ${formattedPostDate}</span>
                </div>
                ${editDeleteButtons}
            </div>
        `;

        // Adicionar estrutura de expansão
        const { closeBtn, expandIndicator } = createExpandedCardStructure(post, postCard);

        // Event listeners
        postCard.addEventListener('click', (e) => {
            // Não expandir se clicou em botões ou imagem
            if (e.target.classList.contains('edit-btn') || 
                e.target.classList.contains('delete-btn') ||
                e.target.classList.contains('post-image') ||
                e.target.classList.contains('close-expanded-card')) {
                return;
            }
            expandCard(postCard, post);
        });

        // Clique na imagem para ampliar (funciona tanto no modo compacto quanto expandido)
        const postImage = postCard.querySelector('.post-image');
        postImage.addEventListener('click', (e) => {
            e.stopPropagation();
            enlargeImage(post.image_url);
        });

        closeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            collapseCard(postCard);
        });

        // Event listeners para botões de edição/exclusão
        if (isEditable) {
            const editBtn = postCard.querySelector('.edit-btn');
            const deleteBtn = postCard.querySelector('.delete-btn');
            
            if (editBtn) {
                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openEditModal(post);
                });
            }
            
            if (deleteBtn) {
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deletePost(post.id, post.created_at);
                });
            }
        }

        muralContainer.appendChild(postCard);
    }

    function openEditModal(post) {
        document.getElementById('modal-title').textContent = 'Editar Postagem';
        document.getElementById('submit-post-btn').textContent = 'Salvar Alterações';
        document.getElementById('post-id').value = post.id;
        document.getElementById('post-title').value = post.title;
        document.getElementById('post-description').value = post.description;
        document.getElementById('post-author').value = post.author;
        document.getElementById('post-tags').value = post.tags;
        document.getElementById('photo-date').value = post.photo_date ? post.photo_date.split('T')[0] : '';
        document.getElementById('post-image').required = false;
        document.getElementById('image-info').style.display = 'block';
        newPostModal.style.display = 'block';
        
        // Fechar card expandido se estiver aberto
        if (expandedCard) {
            collapseCard(expandedCard.element);
        }
        
        setTimeout(() => {
            const success = initializeColorSelector();
            if (success) {
                const colorSwatches = document.querySelectorAll('.color-selector .color-swatch');
                colorSwatches.forEach(swatch => {
                    swatch.classList.remove('selected');
                    if (swatch.dataset.color === post.color) {
                        swatch.classList.add('selected');
                    }
                });
                if (!document.querySelector('.color-swatch.selected')) {
                    const firstColor = document.querySelector('.color-swatch');
                    if (firstColor) {
                        firstColor.classList.add('selected');
                    }
                }
            }
        }, 150);
    }

    async function fetchPosts() {
        const sortBy = sortBySelect.value;
        const sortOrder = sortOrderSelect.value;
        const searchTerm = searchInput.value;
        const queryParams = new URLSearchParams({
            limit: postsPerPage,
            page: currentPage,
            sortBy,
            sortOrder,
            searchTerm
        });

        try {
            const response = await fetch(`${API_URL}/api/posts?${queryParams}`);
            if (!response.ok) {
                throw new Error('Erro ao buscar postagens da API');
            }
            const data = await response.json();
            const posts = data.posts;
            totalPosts = data.total;
            
            muralContainer.innerHTML = '';
            
            if (posts.length === 0) {
                const noPostsMessage = document.createElement('div');
                noPostsMessage.className = 'no-posts';
                noPostsMessage.textContent = searchTerm ? 
                    `Nenhuma postagem encontrada para "${searchTerm}"` : 
                    'Nenhuma postagem encontrada';
                muralContainer.appendChild(noPostsMessage);
            } else {
                posts.forEach(post => createPostElement(post));
            }
            
            updatePaginationControls();
        } catch (error) {
            console.error('Erro ao buscar postagens:', error);
            alert('Erro ao buscar postagens. Verifique sua conexão ou a API.');
        }
    }
    
    function updatePaginationControls() {
        const totalPages = Math.ceil(totalPosts / postsPerPage);
        pageInfoSpan.textContent = `Página ${currentPage} de ${totalPages}`;
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = currentPage * postsPerPage >= totalPosts;
    }

    // Event listeners para busca e filtros
    if (searchInput) {
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                currentPage = 1;
                fetchPosts();
            }
        });
    }
    
    sortBySelect.addEventListener('change', () => { currentPage = 1; fetchPosts(); });
    sortOrderSelect.addEventListener('change', () => { currentPage = 1; fetchPosts(); });
    
    prevPageBtn.addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            fetchPosts();
        }
    });
    
    nextPageBtn.addEventListener('click', () => {
        if (currentPage * postsPerPage < totalPosts) {
            currentPage++;
            fetchPosts();
        }
    });

    // Form submission
    if (postForm) {
        postForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            const postId = document.getElementById('post-id').value;
            const title = document.getElementById('post-title').value;
            const description = document.getElementById('post-description').value;
            const author = document.getElementById('post-author').value;
            const photoDate = document.getElementById('photo-date').value;
            const tags = document.getElementById('post-tags').value;
            const imageFile = document.getElementById('post-image').files[0];
            
            let selectedColor = 'rgba(255, 255, 255, 0.8)';
            const selectedColorElement = document.querySelector('.color-swatch.selected');
            if (selectedColorElement && selectedColorElement.dataset.color) {
                selectedColor = selectedColorElement.dataset.color;
            } else {
                const firstColor = document.querySelector('.color-swatch');
                if (firstColor) {
                    selectedColor = firstColor.dataset.color;
                }
            }

            // Validações
            if (!title || !description || !author || !photoDate) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }

            if (title.length > LIMIT_TITLE) {
                alert(`O título deve ter no máximo ${LIMIT_TITLE} caracteres.`);
                return;
            }
            if (description.length > LIMIT_DESCRIPTION) {
                alert(`A descrição deve ter no máximo ${LIMIT_DESCRIPTION} caracteres.`);
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            if (photoDate > today) {
                alert('A data da foto não pode ser futura.');
                return;
            }

            // Iniciar loading
            loadingManager.show();
            loadingManager.updateProgress(10, 'Validando dados...', 'Verificando informações');

            let imageUrl = null;
            
            // Upload de imagem se fornecida
            if (imageFile) {
                imageUrl = await uploadImage(imageFile);
                if (!imageUrl) {
                    loadingManager.hide();
                    alert('Erro ao enviar a imagem. Por favor, tente novamente.');
                    return;
                }
            }

            // Preparar dados da postagem
            const postData = {
                title,
                image_url: imageUrl,
                description,
                author,
                photo_date: photoDate,
                tags,
                color: selectedColor
            };
            
            const method = postId ? 'PUT' : 'POST';
            const endpoint = postId ? `${API_URL}/api/posts?id=${postId}` : `${API_URL}/api/posts`;
            
            try {
                loadingManager.updateProgress(80, 'Salvando postagem...', 'Conectando ao banco de dados');
                
                const response = await fetch(endpoint, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(postData)
                });

                if (!response.ok) {
                    throw new Error('Erro ao salvar a postagem na API');
                }
                
                const result = await response.json();
                
                // Armazenar informações da postagem criada
                if (result.id) {
                    localStorage.setItem('createdPostId', result.id);
                    localStorage.setItem('createdPostTime', result.created_at);
                }

                loadingManager.updateProgress(95, 'Finalizando...', 'Quase pronto');
                
                // Mostrar sucesso
                setTimeout(() => {
                    loadingManager.showSuccess(postId ? 'Postagem atualizada!' : 'Postagem publicada!');
                    
                    setTimeout(() => {
                        loadingManager.hide();
                        window.location.reload();
                    }, 2000);
                }, 500);
                
            } catch (error) {
                console.error('Erro ao salvar a postagem na API:', error);
                loadingManager.showError('Erro ao salvar postagem');
                setTimeout(() => {
                    alert('Erro ao salvar a postagem. Tente novamente.');
                }, 1000);
            }
        });
    }

    async function deletePost(postId, createdAt) {
        const fiveMinutesAgo = new Date(new Date() - (EDIT_TIME_LIMIT_MINUTES * 60 * 1000));
        if (new Date(createdAt) < fiveMinutesAgo) {
            alert('Não é possível excluir esta postagem. O limite de 5 minutos foi excedido.');
            return;
        }
        if (!confirm(`Tem certeza que deseja excluir a postagem?`)) {
            return;
        }

        try {
            const response = await fetch(`${API_URL}/api/posts?id=${postId}`, {
                method: 'DELETE'
            });

            if (!response.ok) {
                throw new Error('Erro ao excluir a postagem');
            }
            localStorage.removeItem('createdPostId');
            localStorage.removeItem('createdPostTime');
            
            // Fechar card expandido se for o que está sendo excluído
            if (expandedCard && expandedCard.post.id === postId) {
                collapseCard(expandedCard.element);
            }
            
            fetchPosts();
        } catch (error) {
            console.error('Erro ao excluir postagem:', error);
            alert('Erro ao excluir a postagem. Tente novamente.');
        }
    }

    // Função global para ampliar imagem
    window.enlargeImage = (imageUrl) => {
        enlargedImage.src = imageUrl;
        enlargedImageModal.style.display = 'block';
    };

    // Melhorias de acessibilidade
    document.addEventListener('keydown', (e) => {
        // Tab navigation para cards
        if (e.key === 'Tab' && !e.shiftKey) {
            const cards = document.querySelectorAll('.post-card:not(.expanded)');
            // Implementar navegação por tab se necessário
        }
    });

    // Otimização para dispositivos touch
    let touchStartY = 0;
    let touchEndY = 0;

    document.addEventListener('touchstart', (e) => {
        touchStartY = e.changedTouches[0].screenY;
    });

    document.addEventListener
    padding: 8px;
    font-family: 'Poppins', sans-serif;
}

@media (max-width: 767px) {
    .search-controls {
        width: 100%;
    }
    
    .select-trigger {
        min-width: auto;
        flex: 1;
    }
    
    .select-trigger.sort-select {
        min-width: auto;
    }
}

@media (max-width: 1023px) {
    .nova-postagem-btn {
        width: 100%;
    }
}

/* ===== NOVO SISTEMA DE GRID RESPONSIVO ===== */
#mural-container {
    display: grid;
    gap: 16px;
    padding: 20px 0;
}

/* Mobile: 2 colunas */
@media (max-width: 767px) {
    #mural-container {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }
}

/* Tablet: 3 colunas */
@media (min-width: 768px) and (max-width: 1199px) {
    #mural-container {
        grid-template-columns: repeat(3, 1fr);
        gap: 14px;
    }
}

/* Desktop: 4 colunas */
@media (min-width: 1200px) {
    #mural-container {
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
    }
}

/* ===== CARDS COMPACTOS COM EXPANSÃO ===== */
.post-card {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.4);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 3px 15px rgba(0, 0, 0, 0.08);
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    cursor: pointer;
    position: relative;
    height: fit-content;
}

.post-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

/* Estado compacto (padrão) */
.post-card.compact {
    height: auto;
}

/* Estado expandido */
.post-card.expanded {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(1);
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    z-index: 1500;
    overflow-y: auto;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(20px);
    background: rgba(255, 255, 255, 0.95);
}

.post-card.expanded:hover {
    transform: translate(-50%, -50%) scale(1);
}

/* Overlay para cards expandidos */
.post-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px);
    z-index: 1400;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.post-overlay.active {
    opacity: 1;
    visibility: visible;
}

/* Conteúdo dos cards */
.post-card-content {
    padding: 12px;
}

.post-card.expanded .post-card-content {
    padding: 24px;
}

/* Título */
.post-title {
    margin: 0 0 8px 0;
    font-size: 14px;
    font-weight: 600;
    color: var(--primary-color);
    line-height: 1.2;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.post-card.expanded .post-title {
    font-size: 20px;
    -webkit-line-clamp: unset;
    margin-bottom: 16px;
}

/* Container da imagem */
.post-image-container {
    width: 100%;
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    margin-bottom: 8px;
}

.post-card.expanded .post-image-container {
    margin-bottom: 16px;
    border-radius: 12px;
}

.post-image {
    width: 100%;
    height: 140px;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.post-card.expanded .post-image {
    height: 200px;
}

.post-image:hover {
    transform: scale(1.02);
}

/* Descrição */
.post-description {
    font-size: 12px;
    color: var(--text-color);
    line-height: 1.4;
    margin: 0 0 8px 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.post-card.expanded .post-description {
    font-size: 14px;
    -webkit-line-clamp: unset;
    margin-bottom: 16px;
    line-height: 1.6;
}

/* Tags compactas */
.post-tags {
    margin: 6px 0;
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
}

.post-card.expanded .post-tags {
    margin: 12px 0 16px 0;
    gap: 6px;
}

.post-tags span {
    background: var(--primary-color);
    color: white;
    padding: 2px 6px;
    border-radius: 8px;
    font-size: 10px;
    font-weight: 500;
    transition: all 0.2s ease;
}

.post-card.expanded .post-tags span {
    padding: 4px 8px;
    font-size: 11px;
    border-radius: 10px;
    cursor: pointer;
}

.post-card.expanded .post-tags span:hover {
    background: var(--secondary-color);
    transform: scale(1.05);
}

/* Meta informações compactas */
.post-meta {
    display: flex;
    flex-direction: column;
    font-size: 10px;
    color: var(--secondary-color);
    gap: 2px;
    padding-top: 6px;
    border-top: 1px solid rgba(0, 0, 0, 0.08);
}

.post-card.expanded .post-meta {
    font-size: 12px;
    gap: 4px;
    padding-top: 12px;
    margin-top: 16px;
}

.post-author, .post-date {
    margin: 0;
    font-weight: 500;
}

.post-card.expanded .post-author {
    font-weight: 600;
    color: var(--primary-color);
}

/* Botão de fechar para cards expandidos */
.close-expanded-card {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 32px;
    height: 32px;
    background: rgba(0, 0, 0, 0.6);
    color: white;
